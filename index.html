<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Descript Billing Calculator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .calculator {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        .left-panel {
            display: flex;
            flex-direction: column;
        }
        .right-panel {
            position: sticky;
            top: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .right-panel #results {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        h1 {
            color: #ffffff;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 25px;
            padding: 25px;
            background-color: #3a3a3a;
            border-radius: 8px;
        }
        .section h3 {
            margin-top: 0;
            color: #f0f0f0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #d0d0d0;
        }
        select, input {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            padding: 10px 30px 10px 10px;
            border: 1px solid #555;
            border-radius: 6px;
            font-size: 14px;
            background-color: #4a4a4a;
            color: #e0e0e0;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23e0e0e0" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
        }
        input[type="date"], input[type="number"] {
            padding: 10px;
            background-image: none;
        }
        .result {
            background-color: #1e3a5f;
            border: 2px solid #4a90e2;
            padding: 25px;
            border-radius: 8px;
            margin-top: 0;
            height: calc(100% - 50px);
            min-height: 400px;
        }
        .result h4 {
            margin-top: 0;
            color: #87ceeb;
        }
        .cost-breakdown {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #ddd;
        }
        .line-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            color: #333;
        }
        .line-item:last-child {
            border-bottom: none;
        }
        .line-item.total {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #333;
            color: #333;
        }
        .line-item.credit {
            color: #28a745;
        }
        .line-item.credit span {
            color: #28a745;
        }
        .line-item span {
            color: #333;
            font-weight: 500;
        }
        .receipt-header {
            text-align: center;
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #e0e0e0;
        }
        .receipt-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 2px 0;
            color: #e0e0e0;
        }
        .receipt-line.total {
            border-top: 1px solid #555;
            border-bottom: 2px double #777;
            margin-top: 10px;
            padding: 8px 0;
            font-weight: bold;
            font-size: 16px;
        }
        .receipt-line.subtotal {
            border-top: 1px solid #555;
            margin-top: 8px;
            padding-top: 8px;
        }
        .credit {
            color: #ff6b6b;
        }
        .charge {
            color: #51cf66;
        }
        .warning {
            background-color: #5a4a1a;
            border: 1px solid #d4aa00;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            color: #ffeb3b;
        }
        button {
            background-color: #4a90e2;
            color: white;
            padding: 15px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 25px;
        }
        button:hover {
            background-color: #357abd;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .quantity-control input {
            text-align: center;
            flex: 1;
            min-width: 60px;
        }
        .quantity-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
        }
        .quantity-btn:hover {
            background-color: #357abd;
        }
        .quantity-btn:active {
            background-color: #2d5aa0;
        }
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .right-panel {
                position: relative;
            }
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>Descript Billing Calculator</h1>
        
        <div class="main-layout">
            <div class="left-panel">
                <div class="section">
            <h3>Current Subscription</h3>
            <div class="grid">
                <div class="form-group">
                    <label for="currentPlan">Current Plan:</label>
                    <select id="currentPlan">
                        <option value="hobbyist">Hobbyist</option>
                        <option value="creator">Creator</option>
                        <option value="business">Business</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="currentEditors">Current Editors:</label>
                    <div class="quantity-control">
                        <button type="button" class="quantity-btn" onclick="changeQuantity('currentEditors', -1)">−</button>
                        <input type="number" id="currentEditors" value="1" min="1" max="100" readonly>
                        <button type="button" class="quantity-btn" onclick="changeQuantity('currentEditors', 1)">+</button>
                    </div>
                </div>
            </div>
            <div class="grid">
                <div class="form-group">
                    <label for="currentBilling">Current Billing:</label>
                    <select id="currentBilling">
                        <option value="monthly">Monthly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lastInvoiceDate">Last invoice date:</label>
                    <input type="date" id="lastInvoiceDate">
                </div>
            </div>
        </div>

                <div class="section">
            <h3>Proposed Changes</h3>
            <div class="grid">
                <div class="form-group">
                    <label for="newPlan">New Plan:</label>
                    <select id="newPlan">
                        <option value="hobbyist">Hobbyist</option>
                        <option value="creator">Creator</option>
                        <option value="business">Business</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newEditors">New Editors:</label>
                    <div class="quantity-control">
                        <button type="button" class="quantity-btn" onclick="changeQuantity('newEditors', -1)">−</button>
                        <input type="number" id="newEditors" value="1" min="1" max="100" readonly>
                        <button type="button" class="quantity-btn" onclick="changeQuantity('newEditors', 1)">+</button>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="newBilling">New Billing Schedule:</label>
                <select id="newBilling">
                    <option value="monthly">Monthly</option>
                    <option value="annual">Annual</option>
                </select>
            </div>
        </div>

                <button onclick="calculateCosts()">Calculate Costs</button>
            </div>

            <div class="right-panel">
                <div id="results">
                    <div class="result">
                        <h4>Cost Calculation Results</h4>
                        <p style="color: #666; font-style: italic;">Configure your settings and click "Calculate Costs" to see the results here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const planPrices = {
            hobbyist: { monthly: 24, annual: 144 },
            creator: { monthly: 35, annual: 288 },
            business: { monthly: 65, annual: 600 }
        };

        function changeQuantity(inputId, change) {
            const input = document.getElementById(inputId);
            const currentValue = parseInt(input.value);
            const newValue = currentValue + change;
            const min = parseInt(input.min);
            const max = parseInt(input.max);
            
            if (newValue >= min && newValue <= max) {
                input.value = newValue;
            }
        }

        function getDaysSinceDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            return Math.floor((today - date) / (1000 * 60 * 60 * 24));
        }

        function calculateCosts() {
            const currentPlan = document.getElementById('currentPlan').value;
            const currentEditors = parseInt(document.getElementById('currentEditors').value);
            const currentBilling = document.getElementById('currentBilling').value;
            const daysInCycle = getDaysSinceDate(document.getElementById('lastInvoiceDate').value);
            
            const newPlan = document.getElementById('newPlan').value;
            const newEditors = parseInt(document.getElementById('newEditors').value);
            const newBilling = document.getElementById('newBilling').value;

            const currentMonthlyRate = planPrices[currentPlan].monthly * currentEditors;
            const newMonthlyRate = planPrices[newPlan].monthly * newEditors;
            
            // Calculate days left in cycle based on billing type
            const cycleDays = currentBilling === 'annual' ? 365 : 30;
            const daysLeft = cycleDays - daysInCycle;
            const prorationFactor = daysLeft / cycleDays;

            let immediateCharge = 0;
            let nextBillAmount = 0;
            let timing = '';
            let explanation = '';

            const isUpgrade = (newPlan !== currentPlan && planPrices[newPlan].monthly > planPrices[currentPlan].monthly) || 
                             (newEditors > currentEditors) ||
                             (newPlan === currentPlan && newBilling === 'monthly' && currentBilling === 'annual');
            const isBillingChange = newBilling !== currentBilling;

            if (isUpgrade || (isBillingChange && isUpgrade)) {
                timing = 'Takes effect immediately';
                
                if (newBilling === 'annual' && currentBilling === 'monthly') {
                    const annualCost = planPrices[newPlan].annual * newEditors;
                    const currentMonthlyCost = currentMonthlyRate;
                    const creditForUnusedDays = currentMonthlyCost * prorationFactor;
                    immediateCharge = annualCost - creditForUnusedDays;
                    nextBillAmount = annualCost;
                    explanation = `$${annualCost.toFixed(2)} - $${creditForUnusedDays.toFixed(2)} credit = $${immediateCharge.toFixed(2)}`;
                } else if (newBilling === 'monthly' && currentBilling === 'annual') {
                    const currentAnnualCost = planPrices[currentPlan].annual * currentEditors;
                    const dailyRate = currentAnnualCost / 365;
                    const daysRemainingInYear = 365 - daysInCycle;
                    const prepaidCredit = dailyRate * daysRemainingInYear;
                    
                    immediateCharge = Math.max(0, newMonthlyRate - prepaidCredit);
                    nextBillAmount = newMonthlyRate;
                    
                    explanation = `$${newMonthlyRate.toFixed(2)} - $${prepaidCredit.toFixed(2)} credit = $${immediateCharge.toFixed(2)}`;
                } else {
                    const rateDifference = newMonthlyRate - currentMonthlyRate;
                    immediateCharge = rateDifference * prorationFactor;
                    nextBillAmount = newBilling === 'annual' ? planPrices[newPlan].annual * newEditors : newMonthlyRate;
                    explanation = `($${newMonthlyRate.toFixed(2)} - $${currentMonthlyRate.toFixed(2)}) × ${(prorationFactor * 100).toFixed(1)}% = $${immediateCharge.toFixed(2)}`;
                }
            } else if (!isUpgrade && !isBillingChange) {
                timing = 'Takes effect at end of current billing cycle';
                immediateCharge = 0;
                nextBillAmount = newMonthlyRate;
                explanation = 'No immediate charge - downgrade at cycle end';
            } else if (isBillingChange && !isUpgrade) {
                timing = 'Takes effect at start of next billing cycle';
                immediateCharge = 0;
                nextBillAmount = newBilling === 'annual' ? planPrices[newPlan].annual * newEditors : newMonthlyRate;
                explanation = 'No immediate charge - change at renewal';
            }

            // Handle negative immediate charges as credits
            let actualNextBillAmount = nextBillAmount;
            let creditApplied = 0;
            
            if (immediateCharge < 0) {
                creditApplied = Math.abs(immediateCharge);
                actualNextBillAmount = Math.max(0, nextBillAmount - creditApplied);
                immediateCharge = 0; // No immediate charge when there's a credit
            }

            const currentPlanName = currentPlan.charAt(0).toUpperCase() + currentPlan.slice(1);
            const newPlanName = newPlan.charAt(0).toUpperCase() + newPlan.slice(1);
            
            const currentPlanCost = currentBilling === 'annual' ? planPrices[currentPlan].annual * currentEditors : currentMonthlyRate;
            const newPlanCostValue = newBilling === 'annual' ? planPrices[newPlan].annual * newEditors : newMonthlyRate;
            
            const creditsIssued = currentPlanCost * prorationFactor;
            const totalCost = Math.max(0, newPlanCostValue - creditsIssued);
            const remainingCredit = Math.max(0, creditsIssued - newPlanCostValue);
            
            displayResults(currentPlanName, newPlanName, currentPlanCost, newPlanCostValue, creditsIssued, newPlanCostValue, totalCost, remainingCredit);
        }

        function displayResults(currentPlanName, newPlanName, currentPlanCost, newPlanCost, creditsIssued, currentInvoiceTotal, totalCost, remainingCredit) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="result">
                    <h4>Billing Calculation</h4>
                    
                    <div class="cost-breakdown">
                        <div class="line-item">New plan cost: <span>$${newPlanCost.toFixed(2)}</span></div>
                        <div class="line-item">Current plan cost: <span>$${currentPlanCost.toFixed(2)}</span></div>
                        <div class="line-item credit">Credits issued for time remaining on ${currentPlanName}: <span>-$${creditsIssued.toFixed(2)}</span></div>
                        <div class="line-item">Current invoice total: <span>$${currentInvoiceTotal.toFixed(2)}</span></div>
                        <div class="line-item credit">Minus credit applied: <span>-$${creditsIssued.toFixed(2)}</span></div>
                        <div class="line-item total">= Total cost: <span>$${totalCost.toFixed(2)}</span></div>
                        ${remainingCredit > 0 ? `
                        <div class="line-item credit" style="margin-top: 10px; font-style: italic;">with $${remainingCredit.toFixed(2)} amount remaining in credit</div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Set default values
        document.getElementById('newPlan').value = document.getElementById('currentPlan').value;
        document.getElementById('newEditors').value = document.getElementById('currentEditors').value;
        document.getElementById('newBilling').value = document.getElementById('currentBilling').value;
        
        // Set default last invoice date to 15 days ago
        const defaultDate = new Date();
        defaultDate.setDate(defaultDate.getDate() - 15);
        document.getElementById('lastInvoiceDate').value = defaultDate.toISOString().split('T')[0];
    </script>
</body>
</html>